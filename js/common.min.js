var ajax_login={p0:null,p1:null,p2:null,p3:null,func:null};function show_login(e,c,b,a,d){open_new_dialog(null,"/store-admin/dialog/",{},null,"login_dialog",false);ajax_login.p0=e;ajax_login.p1=c;ajax_login.p2=b;ajax_login.p3=a;ajax_login.func=d}function getJSON(){var action=arguments[0];var data=arguments[1];var callback=function(){};var method="get";var async=true;if(arguments.length>=3){callback=arguments[2]}if(arguments.length>=4){method=arguments[3]}if(arguments.length>=5){async=arguments[4]}var request=false;spi();if(method==="get"){if(async){request=$.get(action,data,function(result){hpi();if(!checkJSONResult(result)){show_login(action,data,callback,method,getJSON);return false}if(result.redirect_to){location.href=result.redirect_to;return}if(result.msg){show_msg(result.msg)}callback(result)},"json")}else{var v=$.ajax({url:action,async:false,data:data,dataType:"json"}).responseText;hpi();eval("var result = "+v);if(result.msg){show_msg(result.msg)}return result}}else{if(method==="post"){request=$.post(action,data,function(result){hpi();if(!checkJSONResult(result)){show_login(action,data,callback,method,getJSON);return false}if(result.redirect_to){location.href=result.redirect_to;return}if(result.msg){show_msg(result.msg)}callback(result)},"json")}else{hpi();return false}}return request}function checkJSONResult(a){if(a.logged_out){return false}return true}var dialog_div=[];function attach_dialog(a,c,b,e,d){if(!d){d="dialog_div"}$("body").off("click",a);$("body").on("click",a,function(f){if(f.detail>1){return}var g="";if(e&&(g=e($(this)))===false){return false}open_new_dialog(this,c,b,e,d,g);return false})}function create_dialog(c,a,b){c.foundation()}function create_dialogs(){var a;if(arguments.length==1){a=$(".our-dialog",arguments[0])}else{a=$(".our-dialog")}create_dialog(a)}function open_new_dialog(d,b,a,g,f,c){if(!f){f="dialog_div"}if(!$("#"+f)[0]){dialog_div[f]=$('<div id="'+f+'" class="reveal-modal" data-reveal></div>').appendTo(document.body)}var e=b;if(!c){c=$(d).attr("p")}if(c){if(e.search(/\?/)!=-1){e+="&"+c}else{e+="?"+c}}loadSafe(dialog_div[f],e,function(){create_dialog(dialog_div[f],a,true);$(dialog_div[f]).foundation("reveal","open")})}function close_dialog(a){$(dialog_div[a]).foundation("reveal","close");$(dialog_div[a]).remove()}function loadSafe(element,url,params,callback,show_progress){if(typeof url!=="string"){return $.load(url)}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)}var type="GET";if(params){if($.isFunction(params)){callback=params;params=null}else{if(typeof params==="object"){params=$.param(params);type="POST"}else{if(typeof params==="string"){type="POST"}}}}spi();if(show_progress&&element){element.html('<div class="ajax-loading"><img src="/images/loading.gif" /></div>')}var req=$.ajax({url:url,type:type,dataType:"html",data:params,success:function(result,status,res){hpi();if(result.substr(0,15)==='{"status":false'){if(result.indexOf('"logged_out":true')!==-1){show_login(element,url,params,(callback)?callback:function(){},loadSafe)}else{try{var obj=eval("("+result+")");if(obj.msg){show_msg(obj.msg)}if(typeof dialog_div[element.attr("id")]!="undefined"){element.remove()}}catch(e){}}if(element){element.html("")}return false}if(element&&(status=="success"||status=="notmodified")){element.html(selector?$("<div/>").append(res.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):res.responseText)}if(element&&callback){element.each(callback,[res.responseText,status,res])}else{if(callback){callback(res.responseText,status,res)}}}});return element}$.fn.resetForm=function(){$(this).each(function(){this.reset()})};function openPopupWindow(){var b=arguments[0],a=false,c="";if(arguments.length==2){a=arguments[1]}if(!a){c=" channelmode = no, directories = no, fullscreen = no, height = 500, left = 200, location = no, menubar = no, resizable = no, scrollbars = yes, status = no, titlebar = no, toolbar = no, top = 100, width = 600"}window.open(b,"winChild",c)}var indicator;var indicator_count=0;function spi(){if(jQuery().achtung){if(typeof please_wait_lang=="undefined"){var a='<i class="icon-spinner icon-spin"></i> Please wait ...'}indicator_count++;if(indicator_count==1){indicator=$.achtung({icon:"wait-icon",disableClose:true,message:a,timeout:0})}}}function hpi(){if(jQuery().achtung){indicator_count--;if(indicator_count==0){indicator.achtung("close")}}}var error_msgs=[];function showMsg(h,b){if(h=="error"){var g="";var c=b.match(/^(.+?)(?:<pre>([\s\S]+)?<\/pre>)?$/);if(c!==null){b=c[1];if(typeof c[2]!="undefined"){g=c[2]}}var a=[];$(".achtungFail").each(function(){var i=$(this).find("span.achtung-message").html();var j=i.match(/^(.+?)(?:<pre>([\s\S]+)?<\/pre>)?$/);if(j!==null){i=j[1]}a.push(i)});for(var e in error_msgs){var f=false;for(var d in a){if(error_msgs[e].msg==a[d]){f=d;break}}if(f===false){error_msgs.splice(e,1)}}var k=false;for(var e in error_msgs){if(b==error_msgs[e].msg){k=e;break}}if(k===false){k=error_msgs.push({msg:b,list:g})-1}else{if(g!=""){error_msgs[k].list+="\n"+g}}if(g!=""){b+="<pre>"+error_msgs[k].list+"</pre>"}if(typeof error_msgs[k].obj!=="undefined"){error_msgs[k].obj.achtung("close")}error_msgs[k].obj=$.achtung({message:b,className:"achtungFail",timeout:0})}else{if(h=="success"){$(".achtungFail").achtung("close");$.achtung({message:b,className:"achtungSuccess",timeout:5})}else{if(h=="notice"){$.achtung({message:b,className:"achtungWait",timeout:5})}else{alert("Unknown error.")}}}}function show_msg(b){var a=0;for(type in b){for(a=0;a<b[type].length;a++){showMsg(type,b[type][a])}}}$.fn.outerHTML=function(){return $("<div>").append($(this).clone()).remove().html()};function esc(a){return a.replace(/\./g,"\\.")}function fnSelect(b){if(document.selection){var a=document.body.createTextRange();a.moveToElementText(b);a.select()}else{if(window.getSelection){var a=document.createRange();a.selectNode(b);window.getSelection().addRange(a)}}}function getCaretOffset(b){var g="start",e=true;if(arguments.length>=2){g=arguments[1]}if(arguments.length>=3){e=arguments[2]}var f=0;var i=b.ownerDocument||b.document;var d=i.defaultView||i.parentWindow;var a;if(typeof d.getSelection!="undefined"){var c=d.getSelection().getRangeAt(0);var h=c.cloneRange();h.selectNodeContents(b);if("start"==g){h.setEnd(c.startContainer,c.startOffset)}else{h.setEnd(c.endContainer,c.endOffset)}f=h.toString().length}else{if((a=i.selection)&&a.type!="Control"){var k=a.createRange();var j=i.body.createTextRange();j.moveToElementText(b);if("start"==g){j.setEndPoint("StartToEnd",k)}else{j.setEndPoint("EndToEnd",k)}f=j.text.length}}if(e){f=correctCaretOffsetForHtml(b,f)}return f}function correctCaretOffsetForHtml(d,f){var c=$(d).html();var g=0;while(true){var a=Math.min(c.indexOf("<"),c.indexOf("&"));if(a==-1){a=Math.max(c.indexOf("<"),c.indexOf("&"))}if(a==-1){break}c=c.substring(a);g+=a;if(g>=f){break}var e;if("&"==c[0]){var b=c.match(/^&#?[A-Za-z0-9]{1,7};/);if(!b){c=c.substring(1);g+=1;continue}e=b[0].length-1}else{e=c.indexOf(">")+1}c=c.substring(e);f+=e;g+=e}return f}function getSelectionRange(a){return[getCaretOffset(a,"start"),getCaretOffset(a,"end")]}function getSelectionText(b){var d;var f=b.ownerDocument||b.document;var e=f.defaultView||f.parentWindow;if(typeof e.getSelection!="undefined"){var a=e.getSelection().getRangeAt(0);return a.toString()}else{if((d=f.selection)&&d.type!="Control"){var c=d.createRange();return c.text}}}function setCaretPosition(b,a){b.focus();if(document.selection){sel=document.selection.createRange();sel.moveStart("character",a);sel.select()}else{sel=window.getSelection();sel.collapse(b.firstChild,a)}}function getIndexByBox(c){var a="box-wrap";if(arguments.length>=2){a=arguments[1]}var d=c.prevAll(":not(#long-submenu)").size();var b=c.closest(".content",$("#main-content"));if(!b.size()){return d}d=".content."+d;b=b.closest("."+a).prevAll().size();return b+d}function getBoxByIndex(a){var b="box-wrap";if(arguments.length>=2){b=arguments[1]}return box_wrap=$("."+b+'[data-idx="'+a+'"]')}function str_repeat(b,d){var c;var a="";for(c=0;c<d;c++){a=a+b}return a}function sprintf(g,b){var a="";var f=new RegExp("(.*)%(.*).(.)f(.*)","i");var d=f.exec(g);if(d){a=d[1];var c=d[3];var e=((c>-1)?Math.round(parseFloat(b)*Math.pow(10,c))/Math.pow(10,c):parseFloat(b)).toString();if(e.indexOf(".")==-1){a=a+e+"."+str_repeat("0",c)}else{if(e.length-e.indexOf(".")-1<c){a=a+e+str_repeat("0",c-(e.length-e.indexOf(".")-1))}else{a=a+e}}a=a+d[4];return a}else{return false}};