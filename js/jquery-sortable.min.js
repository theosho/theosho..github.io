!function(k,o,h){var e,n="sortable",m={drag:true,drop:true,exclude:"",nested:true,vertical:true,scale:1},a={afterMove:function(s,d){},containerPath:"",containerSelector:"ol, ul",distance:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(s,d){return true},onCancel:function(s,d,u,t){},onDrag:function(s,d,u,t){s.css(d)},onDragStart:function(s,d,u,t){s.css({height:s.height(),width:s.width()});s.addClass("dragged");k("body").addClass("dragging")},onDrop:function(s,d,u,t){s.removeClass("dragged").removeAttr("style");k("body").removeClass("dragging")},onMousedown:function(d,t,s){s.preventDefault()},placeholder:'<li class="placeholder"/>',pullPlaceholder:true,serialize:function(u,t,s){var d=k.extend({},u.data());if(s){return t}else{if(t[0]){d.children=t;delete d.subContainer}}delete d.sortable;return d},tolerance:0},j={},c=0,f={left:0,top:0,bottom:0,right:0};e={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"};function p(t,s){var d=Math.max(0,t[0]-s[0],s[0]-t[1]),u=Math.max(0,t[2]-s[1],s[1]-t[3]);return d+u}function r(x,d,y,t,u){var w=x.length,v=t?"offset":"position";y=y||0,u=u||1;while(w--){var s=x[w].el?x[w].el:k(x[w]),z=s[v]();z.left+=parseInt(s.css("margin-left"),10);z.top+=parseInt(s.css("margin-top"),10);d[w]=[z.left-y,z.left+s.outerWidth()*u+y,z.top-y,z.top+s.outerHeight()*u+y]}}function l(u,d,t){var s=d.offset(),t=t||1;return{left:(u.left-s.left)/t,top:(u.top-s.top)/t}}function q(u,w,t){w=[w.left,w.top];t=t&&[t.left,t.top];var v,s=u.length,d=[];while(s--){v=u[s];d[s]=[s,p(v,w),t&&p(v,t)]}d=d.sort(function(y,x){return x[1]-y[1]||x[2]-y[2]||x[0]-y[0]});return d}function i(d){this.options=k.extend({},a,d);this.containers=[];if(!this.options.parentContainer){this.scrollProxy=k.proxy(this.scroll,this);this.dragProxy=k.proxy(this.drag,this);this.dropProxy=k.proxy(this.drop,this);this.placeholder=k(this.options.placeholder);if(!d.isValidTarget){this.options.isValidTarget=h}}}i.get=function(d){if(!j[d.group]){if(!d.group){d.group=c++}j[d.group]=new i(d)}return j[d.group]};i.prototype={dragInit:function(s,d){this.$document=k(d.el[0].ownerDocument);if(d.enabled()){this.toggleListeners("on");this.item=k(s.target).closest(this.options.itemSelector);this.itemContainer=d;this.setPointer(s);this.options.onMousedown(this.item,a.onMousedown,s)}else{this.toggleListeners("on",["drop"])}this.dragInitDone=true},drag:function(v){if(!this.dragging){if(!this.distanceMet(v)){return}this.options.onDragStart(this.item,this.itemContainer,a.onDragStart,v);this.item.before(this.placeholder);this.dragging=true}this.setPointer(v);this.options.onDrag(this.item,l(this.pointer,this.item.offsetParent(),this.options.scale),a.onDrag,v);var d=v.pageX,w=v.pageY,u=this.sameResultBox,s=this.options.tolerance;if(!u||u.top-s>w||u.bottom+s<w||u.left-s>d||u.right+s<d){if(!this.searchValidTarget()){this.placeholder.detach()}}},drop:function(d){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0]){this.placeholder.before(this.item).detach()}else{this.options.onCancel(this.item,this.itemContainer,a.onCancel,d)}this.options.onDrop(this.item,this.getContainer(this.item),a.onDrop,d);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=h;this.dragging=false}},searchValidTarget:function(x,v){if(!x){x=this.relativePointer||this.pointer;v=this.lastRelativePointer||this.lastPointer}var s=q(this.getContainerDimensions(),x,v),u=s.length;while(u--){var t=s[u][0],y=s[u][1];if(!y||this.options.pullPlaceholder){var d=this.containers[t];if(!d.disabled){if(!this.$getOffsetParent()){var w=d.getItemOffsetParent();x=l(x,w);v=l(v,w)}if(d.searchValidTarget(x,v)){return true}}}}if(this.sameResultBox){this.sameResultBox=h}},movePlaceholder:function(s,t,v,d){var u=this.lastAppendedItem;if(!d&&u&&u[0]===t[0]){return}t[v](this.placeholder);this.lastAppendedItem=t;this.sameResultBox=d;this.options.afterMove(this.placeholder,s)},getContainerDimensions:function(){if(!this.containerDimensions){r(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent(),this.options.scale)}return this.containerDimensions},getContainer:function(d){return d.closest(this.options.containerSelector).data(n)},$getOffsetParent:function(){if(this.offsetParent===h){var d=this.containers.length-1,s=this.containers[d].getItemOffsetParent();if(!this.options.parentContainer){while(d--){if(s[0]!=this.containers[d].getItemOffsetParent()[0]){s=false;break}}}this.offsetParent=s}return this.offsetParent},setPointer:function(s){var t={left:s.pageX,top:s.pageY};if(this.$getOffsetParent()){var d=l(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=d}this.lastPointer=this.pointer;this.pointer=t},distanceMet:function(d){return(Math.max(Math.abs(this.pointer.left-d.pageX),Math.abs(this.pointer.top-d.pageY))>=this.options.distance)},scroll:function(d){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(t,d){var s=this;d=d||["drag","drop","scroll"];k.each(d,function(u,v){s.$document[t](e[v],s[v+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=h},clearDimensions:function(){this.containerDimensions=h;var d=this.containers.length;while(d--){this.containers[d].clearDimensions()}},destroy:function(){j[this.options.group]=h}};function g(t,s){this.el=t;this.options=k.extend({},m,s);this.group=i.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.parentContainer=this.options.parentContainer;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var d=this.rootGroup.options.itemPath,u=d?this.el.find(d):this.el;u.on(e.start,this.handle,k.proxy(this.dragInit,this));if(this.options.drop){this.group.containers.push(this)}}g.prototype={dragInit:function(s){var d=this.rootGroup;if(!d.dragInitDone&&s.which===1&&this.options.drag&&!k(s.target).is(this.options.exclude)){d.dragInit(s,this)}},searchValidTarget:function(d,t){var w=q(this.getItemDimensions(),d,t),u=w.length,x=this.rootGroup,y=!x.options.isValidTarget||x.options.isValidTarget(x.item,this);if(!u&&y){x.movePlaceholder(this,this.el,"append");return true}else{while(u--){var v=w[u][0],s=w[u][1];if(!s&&this.hasChildGroup(v)){var z=this.getContainerGroup(v).searchValidTarget(d,t);if(z){return true}}else{if(y){this.movePlaceholder(v,d);return true}}}}},movePlaceholder:function(z,s){var D=k(this.items[z]),y=this.itemDimensions[z],d="after",t=D.outerWidth(),C=D.outerHeight(),x=D.offset(),u={left:x.left,right:x.left+t,top:x.top,bottom:x.top+C};if(this.options.vertical){var B=(y[2]+y[3])/2,A=s.top<=B;if(A){d="before";u.bottom-=C*(1-this.options.scale/2)}else{u.top+=C*(1-this.options.scale/2)}}else{var v=(y[0]+y[1])/2,w=s.left<=v;if(w){d="before";u.right-=t*(1-this.options.scale/2)}else{u.left+=t*(1-this.options.scale/2)}}if(this.hasChildGroup(z)){u=f}this.rootGroup.movePlaceholder(this,D,d,u)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get();r(this.items,this.itemDimensions=[],this.options.tolerance,null,this.options.scale)}return this.itemDimensions},getItemOffsetParent:function(){var s,d=this.el;if(d.css("position")==="relative"||d.css("position")==="absolute"||d.css("position")==="fixed"){s=d}else{s=d.offsetParent()}return s},hasChildGroup:function(d){return this.options.nested&&this.getContainerGroup(d)},getContainerGroup:function(t){var u=k.data(this.items[t],"subContainer");if(u===h){var s=this.$getChildren(this.items[t],"container");u=false;if(s[0]){var d=k.extend({},this.options,{parentContainer:this,rootGroup:this.rootGroup,group:c++});u=s[n](d).data(n).group}k.data(this.items[t],"subContainer",u)}return u},enabled:function(){return !this.disabled&&(!this.parentContainer||this.parentContainer.enabled())},$getChildren:function(u,t){var s=this.rootGroup.options,v=s[t+"Path"],d=s[t+"Selector"];u=k(u);if(v){u=u.find(v)}return u.children(d)},_serialize:function(u,t){var v=this,d=t?"item":"container",s=this.$getChildren(u,d).not(this.options.exclude).map(function(){return v._serialize(k(this),!t)}).get();return this.rootGroup.options.serialize(u,s,t)},clearDimensions:function(){this.itemDimensions=h;if(this.items&&this.items[0]){var d=this.items.length;while(d--){var s=k.data(this.items[d],"subContainer");if(s){s.clearDimensions()}}}}};var b={enable:function(d){this.disabled=false},disable:function(d){this.disabled=true},serialize:function(){return this._serialize(this.el,true)},destroy:function(){this.rootGroup.destroy()}};k.extend(g.prototype,b);k.fn[n]=function(d){var s=Array.prototype.slice.call(arguments,1);return this.map(function(){var u=k(this),t=u.data(n);if(t&&b[d]){return b[d].apply(t,s)||this}else{if(!t&&(d===h||typeof d==="object")){u.data(n,new g(u,d))}}return this})}}(jQuery,window);